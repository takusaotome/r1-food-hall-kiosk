<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ROUND1 Food Hall - Customer Info</title>
    <style>
        /* „É™„Çª„ÉÉ„ÉàCSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* CSSÂ§âÊï∞ÂÆöÁæ© */
        :root {
            --primary-red: #e60012;
            --secondary-red: #d01324;
            --primary-orange: #fd7e14;
            --primary-green: #28a745;
            --primary-blue: #007bff;
            --background-white: #ffffff;
            --background-cream: #faf7f0;
            --text-dark: #212529;
            --text-light: #6c757d;
            --border-gray: #dee2e6;
            --error-red: #dc3545;
            --success-green: #28a745;
        }

        /* „Éô„Éº„Çπ„É¨„Ç§„Ç¢„Ç¶„Éà */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(180deg, #ffffff 0%, #faf7f0 100%);
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            min-height: 100vh;
        }

        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä */
        .mobile-container {
            width: 100%;
            min-height: 100vh;
            background-color: transparent;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
        }

        .back-button {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            border: 2px solid var(--border-gray);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-button:active {
            transform: scale(0.9);
        }

        .yuu-logo {
            width: 80px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .yuu-logo img {
            height: 100%;
            width: auto;
        }

        .progress-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-step {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--border-gray);
        }

        .progress-step.active {
            background-color: var(--primary-red);
        }

        .progress-step.completed {
            background-color: var(--primary-green);
        }

        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .main-content {
            flex: 1;
            padding: 30px 20px;
            padding-bottom: 120px;
        }

        /* „Éï„Ç©„Éº„É†„Éò„ÉÉ„ÉÄ„Éº */
        .form-header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 0.6s ease-out;
        }

        .form-title {
            font-size: 28px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 10px;
            line-height: 1.2;
        }

        .form-subtitle {
            font-size: 16px;
            color: var(--text-light);
            line-height: 1.5;
            max-width: 300px;
            margin: 0 auto;
        }

        /* Ê≥®Êñá„Çµ„Éû„É™„Éº */
        .order-summary-mini {
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.6s ease-out 0.2s both;
        }

        .summary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-title {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .summary-total {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-green);
        }

        .summary-items {
            font-size: 12px;
            color: var(--text-light);
        }

        .order-type-indicator {
            display: inline-block;
            background-color: var(--primary-blue);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 8px;
        }

        /* „Éï„Ç©„Éº„É† */
        .customer-form {
            display: flex;
            flex-direction: column;
            gap: 25px;
            animation: fadeInUp 0.6s ease-out 0.4s both;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-label {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .required-indicator {
            color: var(--error-red);
            font-size: 18px;
        }

        .input-field {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            border: 2px solid var(--border-gray);
            border-radius: 15px;
            background-color: white;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-blue);
            background-color: #f8f9ff;
            box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.1);
        }

        .input-field.valid {
            border-color: var(--success-green);
            background-color: #f8fff9;
        }

        .input-field.invalid {
            border-color: var(--error-red);
            background-color: #fff8f8;
            animation: shake 0.5s ease-in-out;
        }

        .input-field::placeholder {
            color: var(--text-light);
        }

        /* „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏ */
        .error-message {
            color: var(--error-red);
            font-size: 14px;
            margin-top: 5px;
            min-height: 20px;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .error-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .error-icon {
            font-size: 16px;
        }

        /* ÂÖ•Âäõ„Éí„É≥„Éà */
        .input-hint {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
        }

        /* SMSÂêåÊÑè„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ */
        .consent-section {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .consent-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .consent-checkbox:active {
            transform: scale(0.98);
        }

        .checkbox-input {
            position: relative;
            width: 20px;
            height: 20px;
            margin: 0;
            cursor: pointer;
        }

        .checkbox-input::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-gray);
            border-radius: 4px;
            background-color: white;
            transition: all 0.3s ease;
        }

        .checkbox-input:checked::before {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        .checkbox-input:checked::after {
            content: '‚úì';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .consent-text {
            font-size: 14px;
            color: var(--text-dark);
            line-height: 1.5;
            flex: 1;
        }

        .consent-highlight {
            color: var(--primary-blue);
            font-weight: 600;
        }

        /* ÂøÖÈ†à„Éï„Ç£„Éº„É´„ÉâË™¨Êòé */
        .required-note {
            text-align: center;
            font-size: 12px;
            color: var(--text-light);
            font-style: italic;
            margin-bottom: 30px;
        }

        /* Á∂öË°å„Éú„Çø„É≥ */
        .continue-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            padding: 20px;
            border-top: 1px solid var(--border-gray);
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .continue-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--secondary-red) 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(230, 0, 18, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .continue-btn:active {
            transform: scale(0.98);
        }

        .continue-btn:disabled {
            background: linear-gradient(135deg, var(--border-gray) 0%, #adb5bd 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .continue-btn.loading {
            opacity: 0.8;
            pointer-events: none;
        }

        .continue-btn.loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* „Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥ */
        .cancel-btn {
            width: 100%;
            padding: 12px;
            background-color: transparent;
            color: var(--text-light);
            border: 2px solid var(--border-gray);
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .cancel-btn:active {
            transform: scale(0.98);
            background-color: var(--background-cream);
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
            20%, 40%, 60%, 80% { transform: translateX(3px); }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes success {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .input-field.success {
            animation: success 0.3s ease-out;
        }

        /* ÊàêÂäü„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ */
        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.95) 0%, rgba(32, 201, 151, 0.95) 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            color: white;
            text-align: center;
        }

        .success-content {
            animation: successPop 1.5s ease-out;
        }

        .success-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .success-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .success-message {
            font-size: 16px;
            opacity: 0.9;
        }

        @keyframes successPop {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-height: 700px) {
            .main-content {
                padding: 20px;
                padding-bottom: 100px;
            }
            
            .form-title {
                font-size: 24px;
            }
            
            .customer-form {
                gap: 20px;
            }
        }

        @media (min-width: 768px) {
            .mobile-container {
                max-width: 480px;
                margin: 0 auto;
                box-shadow: 0 0 40px rgba(0, 0, 0, 0.2);
            }
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <header class="header">
            <div class="header-content">
                <div class="back-button" onclick="goBack()">
                    <span>‚Üê</span>
                </div>
                <div class="yuu-logo">
                    <img src="media/yuu_logo.png" alt="YUU">
                </div>
                <div class="progress-indicator">
                    <div class="progress-step completed"></div>
                    <div class="progress-step completed"></div>
                    <div class="progress-step active"></div>
                </div>
            </div>
        </header>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <main class="main-content">
            <!-- „Éï„Ç©„Éº„É†„Éò„ÉÉ„ÉÄ„Éº -->
            <div class="form-header">
                <h1 class="form-title">Almost there!</h1>
                <p class="form-subtitle">
                    We'll send you SMS updates about your order preparation and pickup status
                </p>
            </div>

            <!-- Ê≥®Êñá„Çµ„Éû„É™„Éº -->
            <div class="order-summary-mini">
                <div class="summary-header">
                    <span class="summary-title">Your Order</span>
                    <span class="summary-total" id="orderTotal">$0.00</span>
                </div>
                <div class="summary-items" id="orderItems">
                    0 items
                    <span class="order-type-indicator" id="orderTypeIndicator">DINE IN</span>
                </div>
            </div>

            <!-- È°ßÂÆ¢ÊÉÖÂ†±„Éï„Ç©„Éº„É† -->
            <form class="customer-form" id="customerForm" novalidate>
                <!-- ÂêçÂâç -->
                <div class="input-group">
                    <label class="input-label" for="firstName">
                        First Name
                        <span class="required-indicator">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="firstName" 
                        class="input-field" 
                        placeholder="Enter your first name"
                        maxlength="30"
                        autocomplete="given-name"
                        autocapitalize="words"
                    >
                    <div class="error-message" id="firstNameError">
                        <span class="error-icon">‚ö†Ô∏è</span>
                        <span></span>
                    </div>
                </div>

                <!-- Âßì -->
                <div class="input-group">
                    <label class="input-label" for="lastName">
                        Last Name
                        <span class="required-indicator">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="lastName" 
                        class="input-field" 
                        placeholder="Enter your last name"
                        maxlength="30"
                        autocomplete="family-name"
                        autocapitalize="words"
                    >
                    <div class="error-message" id="lastNameError">
                        <span class="error-icon">‚ö†Ô∏è</span>
                        <span></span>
                    </div>
                </div>

                <!-- ÈõªË©±Áï™Âè∑ -->
                <div class="input-group">
                    <label class="input-label" for="phoneNumber">
                        Phone Number
                        <span class="required-indicator">*</span>
                    </label>
                    <input 
                        type="tel" 
                        id="phoneNumber" 
                        class="input-field" 
                        placeholder="(000) 000-0000"
                        maxlength="14"
                        autocomplete="tel"
                        inputmode="numeric"
                    >
                    <div class="input-hint">We'll send SMS updates about your order</div>
                    <div class="error-message" id="phoneNumberError">
                        <span class="error-icon">‚ö†Ô∏è</span>
                        <span></span>
                    </div>
                </div>

                <!-- SMSÂêåÊÑè -->
                <div class="consent-section">
                    <label class="consent-checkbox" for="smsConsent">
                        <input type="checkbox" id="smsConsent" class="checkbox-input" required>
                        <div class="consent-text">
                            I agree to receive <span class="consent-highlight">SMS notifications</span> about my order status. 
                            Standard messaging rates may apply. You can opt out at any time.
                        </div>
                    </label>
                </div>

                <!-- ÂøÖÈ†à„Éï„Ç£„Éº„É´„ÉâË™¨Êòé -->
                <div class="required-note">
                    <span class="required-indicator">*</span> Required fields
                </div>
            </form>
        </main>

        <!-- Á∂öË°å„Éú„Çø„É≥„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="continue-section">
            <button type="button" class="cancel-btn" onclick="cancelOrder()">Cancel Order</button>
            <button type="submit" class="continue-btn" id="continueBtn" onclick="handleSubmit()" disabled>
                <span>Complete Order</span>
            </button>
        </div>

        <!-- ÊàêÂäü„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
        <div class="success-overlay" id="successOverlay">
            <div class="success-content">
                <div class="success-icon">‚úÖ</div>
                <div class="success-title">Order Placed!</div>
                <div class="success-message">You'll receive SMS updates shortly</div>
            </div>
        </div>
    </div>

    <script>
        // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„É´„Éº„É´
        const validation = {
            firstName: {
                required: true,
                minLength: 2,
                pattern: /^[a-zA-Z\s\-']+$/,
                message: 'First name should contain only letters, spaces, hyphens, and apostrophes'
            },
            lastName: {
                required: true,
                minLength: 2,
                pattern: /^[a-zA-Z\s\-']+$/,
                message: 'Last name should contain only letters, spaces, hyphens, and apostrophes'
            },
            phoneNumber: {
                required: true,
                pattern: /^\(\d{3}\) \d{3}-\d{4}$/,
                message: 'Please enter a valid phone number'
            }
        };

        // Áä∂ÊÖãÁÆ°ÁêÜ
        let isSubmitting = false;
        let cart = JSON.parse(sessionStorage.getItem('cart')) || [];

        // ÂàùÊúüÂåñ
        function init() {
            loadOrderSummary();
            setupEventListeners();
            focusFirstField();
            updateContinueButton();
        }

        // Ê≥®Êñá„Çµ„Éû„É™„ÉºË™≠„ÅøËæº„Åø
        function loadOrderSummary() {
            const orderType = sessionStorage.getItem('orderType') || 'HERE';
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const savings = cart.reduce((sum, item) => {
                if (item.isComboItem && item.originalPrice) {
                    return sum + ((item.originalPrice - item.price) * item.quantity);
                }
                return sum;
            }, 0);
            const tax = (subtotal - savings) * 0.08875;
            const total = subtotal - savings + tax;

            document.getElementById('orderTotal').textContent = `$${total.toFixed(2)}`;
            document.getElementById('orderItems').innerHTML = `
                ${totalItems} item${totalItems !== 1 ? 's' : ''}
                <span class="order-type-indicator" style="background-color: ${orderType === 'HERE' ? 'var(--primary-blue)' : 'var(--primary-orange)'}">
                    ${orderType === 'HERE' ? 'DINE IN' : 'TAKE OUT'}
                </span>
            `;
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        function setupEventListeners() {
            const fields = ['firstName', 'lastName', 'phoneNumber'];
            const smsConsent = document.getElementById('smsConsent');

            // ÂêÑ„Éï„Ç£„Éº„É´„Éâ„ÅÆ„Ç§„Éô„É≥„Éà
            fields.forEach(fieldName => {
                const field = document.getElementById(fieldName);
                
                field.addEventListener('input', () => {
                    if (fieldName === 'phoneNumber') {
                        formatPhoneNumber(field);
                    }
                    validateField(fieldName);
                    updateContinueButton();
                    hapticFeedback();
                });

                field.addEventListener('blur', () => {
                    validateField(fieldName);
                });

                field.addEventListener('focus', () => {
                    clearFieldError(fieldName);
                });
            });

            // SMSÂêåÊÑè„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ
            smsConsent.addEventListener('change', () => {
                updateContinueButton();
                hapticFeedback();
            });

            // „Éï„Ç©„Éº„É†ÈÄÅ‰ø°
            document.getElementById('customerForm').addEventListener('submit', (e) => {
                e.preventDefault();
                handleSubmit();
            });
        }

        // ÈõªË©±Áï™Âè∑„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatPhoneNumber(field) {
            let value = field.value.replace(/\D/g, '');
            
            if (value.length >= 6) {
                value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
            } else if (value.length >= 3) {
                value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
            }
            
            field.value = value;
        }

        // „Éï„Ç£„Éº„É´„Éâ„Éê„É™„Éá„Éº„Ç∑„Éß„É≥
        function validateField(fieldName) {
            const field = document.getElementById(fieldName);
            const rule = validation[fieldName];
            const value = field.value.trim();

            // ÂøÖÈ†à„ÉÅ„Çß„ÉÉ„ÇØ
            if (rule.required && !value) {
                setFieldError(fieldName, `${getFieldLabel(fieldName)} is required`);
                return false;
            }

            // ÊúÄÂ∞èÈï∑„ÉÅ„Çß„ÉÉ„ÇØ
            if (rule.minLength && value.length < rule.minLength && value.length > 0) {
                setFieldError(fieldName, `${getFieldLabel(fieldName)} must be at least ${rule.minLength} characters`);
                return false;
            }

            // „Éë„Çø„Éº„É≥„ÉÅ„Çß„ÉÉ„ÇØ
            if (rule.pattern && value && !rule.pattern.test(value)) {
                setFieldError(fieldName, rule.message);
                return false;
            }

            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥ÊàêÂäü
            setFieldValid(fieldName);
            return true;
        }

        // „Éï„Ç£„Éº„É´„Éâ„É©„Éô„É´ÂèñÂæó
        function getFieldLabel(fieldName) {
            const labels = {
                firstName: 'First Name',
                lastName: 'Last Name',
                phoneNumber: 'Phone Number'
            };
            return labels[fieldName];
        }

        // „Ç®„É©„ÉºË®≠ÂÆö
        function setFieldError(fieldName, message) {
            const field = document.getElementById(fieldName);
            const errorEl = document.getElementById(`${fieldName}Error`);
            
            field.classList.remove('valid', 'success');
            field.classList.add('invalid');
            errorEl.querySelector('span:last-child').textContent = message;
            errorEl.classList.add('show');
        }

        // „Ç®„É©„Éº„ÇØ„É™„Ç¢
        function clearFieldError(fieldName) {
            const field = document.getElementById(fieldName);
            const errorEl = document.getElementById(`${fieldName}Error`);
            
            field.classList.remove('invalid');
            errorEl.classList.remove('show');
        }

        // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥ÊàêÂäüË®≠ÂÆö
        function setFieldValid(fieldName) {
            const field = document.getElementById(fieldName);
            const errorEl = document.getElementById(`${fieldName}Error`);
            
            field.classList.remove('invalid');
            field.classList.add('valid');
            errorEl.classList.remove('show');
            
            // ÊàêÂäü„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
            setTimeout(() => {
                field.classList.add('success');
                setTimeout(() => field.classList.remove('success'), 300);
            }, 100);
        }

        // Á∂öË°å„Éú„Çø„É≥Áä∂ÊÖãÊõ¥Êñ∞
        function updateContinueButton() {
            const continueBtn = document.getElementById('continueBtn');
            const smsConsent = document.getElementById('smsConsent');
            const allFieldsValid = ['firstName', 'lastName', 'phoneNumber'].every(field => {
                const value = document.getElementById(field).value.trim();
                return value && validateField(field);
            });
            
            continueBtn.disabled = !allFieldsValid || !smsConsent.checked || isSubmitting;
        }

        // „Éï„Ç©„Éº„É†ÈÄÅ‰ø°Âá¶ÁêÜ
        function handleSubmit() {
            if (isSubmitting) return;

            // ÊúÄÁµÇ„Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            const allValid = ['firstName', 'lastName', 'phoneNumber'].every(validateField);
            const smsConsent = document.getElementById('smsConsent').checked;

            if (!allValid || !smsConsent) {
                // „Ç®„É©„Éº„Åå„ÅÇ„Çå„Å∞ÁîªÈù¢„Çí„Ç∑„Çß„Ç§„ÇØ
                document.querySelector('.mobile-container').style.animation = 'shake 0.5s ease-in-out';
                setTimeout(() => {
                    document.querySelector('.mobile-container').style.animation = '';
                }, 500);
                return;
            }

            submitOrder();
        }

        // Ê≥®ÊñáÈÄÅ‰ø°
        function submitOrder() {
            isSubmitting = true;
            const continueBtn = document.getElementById('continueBtn');
            continueBtn.classList.add('loading');
            continueBtn.innerHTML = '<span>Processing...</span>';

            // È°ßÂÆ¢ÊÉÖÂ†±ÂèéÈõÜ
            const customerInfo = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                phoneNumber: document.getElementById('phoneNumber').value.trim(),
                smsConsent: document.getElementById('smsConsent').checked,
                orderType: sessionStorage.getItem('orderType') || 'HERE',
                timestamp: new Date().toISOString()
            };

            // Ê≥®ÊñáÂÆå‰∫ÜÊÉÖÂ†±
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const savings = cart.reduce((sum, item) => {
                if (item.isComboItem && item.originalPrice) {
                    return sum + ((item.originalPrice - item.price) * item.quantity);
                }
                return sum;
            }, 0);
            const tax = (subtotal - savings) * 0.08875;
            const total = subtotal - savings + tax;

            const orderSummary = {
                orderId: 'ORD-' + Date.now(),
                items: cart,
                customer: customerInfo,
                subtotal: subtotal,
                savings: savings,
                tax: tax,
                total: total,
                completedAt: new Date().toISOString()
            };

            // „Çª„ÉÉ„Ç∑„Éß„É≥„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
            sessionStorage.setItem('customerInfo', JSON.stringify(customerInfo));
            sessionStorage.setItem('completedOrder', JSON.stringify(orderSummary));

            // „Éè„Éó„ÉÜ„Ç£„ÉÉ„ÇØ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
            hapticFeedback();

            // ÊàêÂäüË°®Á§∫
            setTimeout(() => {
                showSuccessOverlay(customerInfo, orderSummary.orderId);
                
                // 3ÁßíÂæå„Å´„Çπ„ÇØ„É™„Éº„É≥„Çª„Éº„Éê„Éº„Å´Êàª„Çã
                setTimeout(() => {
                    // „Ç´„Éº„Éà„Çí„ÇØ„É™„Ç¢
                    sessionStorage.removeItem('cart');
                    sessionStorage.removeItem('selectedProductId');
                    
                    // „Çπ„ÇØ„É™„Éº„É≥„Çª„Éº„Éê„Éº„Å´Êàª„Çã
                    window.location.href = 'mobile_01_screensaver.html';
                }, 3000);
            }, 1500);
        }

        // ÊàêÂäü„Ç™„Éº„Éê„Éº„É¨„Ç§Ë°®Á§∫
        function showSuccessOverlay(customerInfo, orderId) {
            const overlay = document.getElementById('successOverlay');
            const content = overlay.querySelector('.success-content');
            
            content.innerHTML = `
                <div class="success-icon">üéâ</div>
                <div class="success-title">Order Placed!</div>
                <div class="success-message">
                    Thank you ${customerInfo.firstName}!<br>
                    Order #${orderId.slice(-6)}<br>
                    SMS updates will be sent to ${customerInfo.phoneNumber}
                </div>
            `;
            
            overlay.style.display = 'flex';
        }

        // Ê≥®Êñá„Ç≠„É£„É≥„Çª„É´
        function cancelOrder() {
            if (confirm('Are you sure you want to cancel your order? All items will be removed from your cart.')) {
                sessionStorage.clear();
                window.location.href = 'mobile_01_screensaver.html';
            }
        }

        // Êàª„Çã
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'mobile_06_order_summary.html';
            }
        }

        // ÊúÄÂàù„ÅÆ„Éï„Ç£„Éº„É´„Éâ„Å´„Éï„Ç©„Éº„Ç´„Çπ
        function focusFirstField() {
            // „É¢„Éê„Ç§„É´„Åß„ÅÆËá™Âãï„Éï„Ç©„Éº„Ç´„Çπ„ÅØÈÅø„Åë„ÇãÔºà„Ç≠„Éº„Éú„Éº„ÉâË°®Á§∫„Å´„Çà„ÇãÁîªÈù¢„É¨„Ç§„Ç¢„Ç¶„ÉàÂ¥©„Çå„ÇíÈò≤„Åê„Åü„ÇÅÔºâ
            // setTimeout(() => {
            //     document.getElementById('firstName').focus();
            // }, 500);
        }

        // „Éè„Éó„ÉÜ„Ç£„ÉÉ„ÇØ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
        function hapticFeedback() {
            if (window.navigator && window.navigator.vibrate) {
                window.navigator.vibrate(10);
            }
        }

        // „Ç≠„Éº„Éú„Éº„Éâ„Ç§„Éô„É≥„Éà
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                cancelOrder();
            } else if (e.key === 'Enter' && !document.getElementById('continueBtn').disabled) {
                handleSubmit();
            }
        });

        // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„ÉàÊúÄÈÅ©Âåñ
        document.addEventListener('touchstart', function(e) {
            const button = e.target.closest('button, .consent-checkbox');
            if (button && !button.disabled) {
                button.style.transform = 'scale(0.98)';
            }
        }, { passive: true });

        document.addEventListener('touchend', function(e) {
            const button = e.target.closest('button, .consent-checkbox');
            if (button) {
                setTimeout(() => {
                    button.style.transform = '';
                }, 100);
            }
        }, { passive: true });

        // ÂàùÊúüÂåñÂÆüË°å
        init();
    </script>
</body>
</html>